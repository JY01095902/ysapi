package ysapi

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestParseEventMessage(t *testing.T) {
	orgiMsg := ` {"encrypt":"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","msgSignature":"220305a054c73b6e6e4c2b9d1549f8fca4bb3b4e","nonce":"GF8nN0vyYTufjtA8","timestamp":1632814228807}`

	appKey := "{APP_KEY}"
	appSecret := "{APP_SECRET}"
	eventMessage, err := ParseEventMessage(orgiMsg)
	assert.NoError(t, err)
	plaintext, err := eventMessage.Decrypt(appKey, appSecret)
	assert.NoError(t, err)
	content, err := plaintext.UnmarshalContent()
	assert.NoError(t, err)
	archive, err := content.UnmarshalArchive()
	assert.NoError(t, err)
	assert.Equal(t, "210008", archive["code"].(string))
}
